/*! PDX Roasters - v0.1.0 - 2013-01-08
* http://PROJECT_WEBSITE/
* Copyright (c) 2013 PDX Roasters; Licensed MIT */
(function(e){e.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},e.indexOf=function(e,t){if(![].indexOf){var n=e.length;for(var r=0;r<n;r++)if(e[r]===t)return r;return-1}return e.indexOf(t)},e.fn.scrollTo=function(t){var n=this.offset().top,r=function(e){window.scrollTo(0,e)};t=t||400,e.tween(t,0,n,r,e.easing.swing)},e.fn.toArray=function(){var e=[];return this.each(function(){e.push(this)}),e},e.fn.index=function(){var t=this.parent().children();return e.indexOf(t.toArray(),this[0])},e.fn.push=function(e){return this[this.length-1]=e},e.fn.add=function(t){var n,r=this.toArray();typeof t=="string"||t.nodeType&&t.nodeType===1?n=e(t):t.length?n=t:console.log("something else");for(var i=0,s=n.length;i<s;i++)r.push(n[i]);return e(r)}})(ender),function(){window.console=window.console||function(){},window.pdx={},window.pdx.app={}}(),function(e,t){var n=new google.maps.Geocoder;e.pdx.maps={},function(){var t=function(){};t.prototype=new google.maps.OverlayView,t.extend=function(e){function r(){this.init&&this.init.apply(this,arguments)}var t=new this;for(var n in e)t[n]||(t[n]=e[n]);return r.prototype=t,r.prototype.constructor=r,r.extend=arguments.callee,r},e.pdx.maps.Overlay=t}(),e.pdx.maps.Marker=e.pdx.maps.Overlay.extend({init:function(e){if(!e||!e.latLng||!e.map)return console.log("[Marker requires latLng and map]"),!1;this.element=document.createElement("div"),this.loaded=!1;for(var t in e)this[t]=e[t];this.setMap(this.map)},onAdd:function(){var e=this;this.element.style.position="absolute",this.element.className="marker-custom",this.element.innerHTML="<div><div></div></div>",this.tooltip=document.createElement("span"),this.tooltip.className="tooltip",this.tooltip.innerHTML="<div>"+this.name+"</div>",this.loader=document.createElement("span"),this.loader.className="plus-spinner",this.loader.innerHTML="<div></div>",this.element.appendChild(this.tooltip),this.element.appendChild(this.loader),this.getPanes().overlayMouseTarget.appendChild(this.element),this.onAddCallback&&typeof this.onAddCallback=="function"&&this.onAddCallback(this)},draw:function(){var e=this.getProjection().fromLatLngToDivPixel(this.latLng);if(!e)return console.log("[Marker failed]"),!1;this.tooltip.style.left=-(this.tooltip.clientWidth/2-this.element.clientWidth/2)+"px",this.loader.style.left=-(this.loader.clientWidth/2-this.element.clientWidth/2)+"px",this.loader.style.top=-(this.loader.clientHeight+3)+"px",this.element.style.left=e.x-this.element.clientWidth/2+"px",this.element.style.top=e.y-this.element.clientHeight+"px",this.element.style.zIndex=999,this.element.parentNode.style.zIndex=999},setPosition:function(e){return this.element?(this.latLng=e,this.draw(),!0):!1},getPosition:function(){return this.element?this.latLng:null},onRemove:function(){return this.element?(this.element.parentNode.removeChild(this.element),!0):!1},remove:function(){if(!this.element)return;this.element.parentNode.removeChild(this.element),this.element=null}}),e.pdx.maps.geocode=function(e,t){n.geocode(e,function(e,n){if(n!==google.maps.GeocoderStatus.OK)return;typeof t=="function"&&t(e[0].geometry.location,e[0])})}}(window),function(e,t){"use strict";e.pdx.app.home={init:function(){this._info(),this._nav(),this._roasters(),this._map(),this._resize()},_nav:function(){var t=this;this.$nav=$("#nav"),this.$navTog=this.$nav.find(".plus"),this.$navLinks=this.$nav.find("a:not(.plus)"),this.$navTog.on("click",function(e){e.preventDefault(),t.$navTog.toggleClass("active"),t.$nav.toggleClass("active"),console.log("check"),t.$navTog.is(".active")?$("[href='"+t.activeHash+"']").click():t.$info.removeClass("active")}),this.$navLinks.on("click",function(n){n.preventDefault(),console.log("check"),t.$info.is(".active")||t.$info.addClass("active"),t.$info.css("top",$(e).scrollTop()),t.$navLinks.removeClass("on"),$(this).addClass("on"),t.$activePanel=$(this.hash),t.activeHash=this.hash,console.log("check"),t.$panelWrap.css("left",-(t.$activePanel.index()*e.innerWidth))})},_map:function(){var t=this;this.$mapWrap=$("#map-wrap"),this.$map=$("#map"),this.mapElem=this.$map.get(0),this.mapMarkers=[],this.$mapWrap.css({height:e.innerHeight,width:e.innerWidth}),this.portland={lat:45.5239,lng:-122.67,latLng:new google.maps.LatLng(45.5239,-122.67)},this.mapSettings={center:this.portland.latLng,disableDoubleClickZoom:!1,draggingCursor:"move",draggableCursor:"default",mapTypeId:google.maps.MapTypeId.ROADMAP,mapTypeControl:!1,panControl:!1,panControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER},scrollwheel:!1,streetViewControl:!0,zoom:15,zoomControlOptions:{position:google.maps.ControlPosition.LEFT_CENTER,style:google.maps.ZoomControlStyle.LARGE}},this.mapBounds=new google.maps.LatLngBounds,this.map=new google.maps.Map(this.mapElem,this.mapSettings);if(!this.$roasterItems.length)return!1;this.$roasterItems.each(function(n){var r=$(this),i=r.data("latlng"),s=r.data("name"),o="/api/roaster/"+this.id+"/",u=r.data("address"),a=this.id,f,l;i?(f=new google.maps.LatLng(i[0],i[1]),l=new e.pdx.maps.Marker({latLng:f,map:t.map,name:s,api:o,id:a,onAddCallback:function(){t._onAddMarker.apply(t,arguments)}}),counter++,t.mapMarkers.push(l),t.mapBounds.extend(f)):e.pdx.maps.geocode({address:u+" Portland, Oregon"},function(n){f=n,l=new e.pdx.maps.Marker({latLng:f,map:t.map,name:s,api:o,id:a,onAddCallback:function(){t._onAddMarker.apply(t,arguments)}}),t.mapMarkers.push(l),t.mapBounds.extend(f),t.mapMarkers.length===t.$roasterItems.length&&t.map.fitBounds(t.mapBounds)})}),this.mapMarkers.length===this.$roasterItems.length&&this.map.fitBounds(this.mapBounds)},_onAddMarker:function(e){var t=this;$(e.element).on("mouseover","> div",function(){var e=$(this),t=e.parent().find(".tooltip");console.log("check");if(e.parent().is(".loaded"))return!1;e.parent().addClass("active"),t.css("top",-(t.height()+3))}).on("mouseout","> div",function(e){var t=$(this),n=t.parent().find(".tooltip");console.log("check");if(t.parent().is(".loaded"))return!1;t.parent().removeClass("active"),n.css("top","50%")}),$(e.element).on("click","> div",function(t){function o(){s=setTimeout(function(){i.toggleClass("loading"),o()},300)}var n=$(this),r=n.parent().find(".tooltip"),i=n.parent().find(".plus-spinner > div"),s;if(e.loaded)return r.toggleClass("inactive"),console.log("check"),r.is(".inactive")?r.css("top","50%"):r.css("top",-(r.height()+3)),!1;r.hide().addClass("loading"),i.parent().addClass("active"),i.addClass("loading"),o(),$.ajax({url:e.api,type:"json",data:{format:"json"},error:function(){clearTimeout(s),console.log("error")},success:function(t){var o="";clearTimeout(s),e.loaded=!0,o="<h3>"+t.name+"</h3>",o+='<div class="group">',o+='<div class="col col1of2">',o+='<div class="ci">'+t.address+"</div>",o+="</div>",o+='<div class="col col1of2">',o+='<p class="hours ci">',o+="Mon. - Fri. <span>8 - 12</span><br />",o+="Sat. <span>8 - 12</span><br />",o+="Sun. <span>8 - 12</span>",o+="</p>",o+="</div>",o+="</div>",o+='<div class="btns group">',o+='<div class="col col1of2">',o+='<div class="ci"><a href="#'+t.id+'" class="btn find">Find this Roast</a></div>',o+="</div>",o+='<div class="col col1of2">',o+='<div class="ci"><a href="/roaster/'+t.slug+'/" class="btn">Learn More</a></div>',o+="</div>",o+="</div>",o+='<a href="#close" class="plus-close">Close</div>',r.addClass("infowindow").html(o).css("top",-(r.height()+3)).css("left",-(r.width()/2-n.width()/2)),r.find(".plus-close").on("click",function(e){e.preventDefault(),r.toggleClass("inactive"),console.log("check"),r.is("inactive")?r.css("top","50%"):r.css("top",-(r.height()+3))}),r.find(".find").on("click",function(e){e.preventDefault();var t=$(this.hash);t.find(".toggle").click()}),setTimeout(function(){r.show().removeClass("loading"),i.parent().removeClass("active"),i.removeClass("loading"),n.parent().addClass("loaded")},300)}})})},_info:function(){this.$info=$("#info-panel"),this.$panelWrap=this.$info.find(".panels"),this.$panels=this.$info.find(".panel"),this.$panelWrap.width(e.innerWidth*this.$panels.length),this.$info.add(this.$panels).css({height:e.innerHeight,width:e.innerWidth})},_roasters:function(){var e=this;this.$roasters=$("#roasters"),this.$roasterItems=this.$roasters.find(".roaster"),this.$roasterTogs=this.$roasters.find(".toggle"),this.$roasterHandles=this.$roasters.find(".handle");if(!this.$roasterItems.length)return this.$roasters.find(".suggest").on("click",function(e){e.preventDefault(),$("[href='"+this.hash+"']").click()}),!1;this.$roasterHandles.on("click",function(t){t.preventDefault();var n=$(this),r=n.find(".toggle"),i=n.closest(".roaster");console.log("check");if(i.is(".active"))return r.removeClass("active"),e.$roasterItems.removeClass("active"),!1;e.$roasterTogs.removeClass("active"),r.addClass("active"),e.$roasterItems.removeClass("active"),i.addClass("active"),i.scrollTo()})},_resize:function(){var t=this;console.log("check"),e.onresize=function(){t.$mapWrap.add(t.$info).add(t.$panels).css({height:e.innerHeight,width:e.innerWidth}),t.$panelWrap.width(e.innerWidth*t.$panels.length)}}},$(".scroll-to").on("click",function(e){e.preventDefault(),$(this.hash).scrollTo()}),$(".ajax-form").on("submit",function(e){e.preventDefault(),$.ajax({url:this.action,type:"json",data:$(this).serialize(),error:function(){console.log("error")},success:function(){console.log("success")}})})}(window),function(){var e=$(document.body).data("controller");window.pdx.app[e]&&window.pdx.app[e].init&&window.pdx.app[e].init()}();